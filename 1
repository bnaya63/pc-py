import serial
import time

# Serial setup
ser = serial.Serial("COM3", 115200, timeout=0)  # Change COM3 to your port
SERIAL_TIMEOUT = 5000  # in milliseconds

last_receive_time = 0
board_is_connected = True

while True:
    if ser.in_waiting > 0:
        # Read incoming data
        data = ser.readline().decode(errors="ignore").strip()
        print("Received:", data)

        # Reset last receive timestamp
        last_receive_time = int(time.time() * 1000)
        host_is_connected = True
    else:
        now = int(time.time() * 1000)
        if last_receive_time != 0 and (now - last_receive_time >= SERIAL_TIMEOUT):
            print("⚠️ Serial timeout — no data received.")
            host_is_connected = False
            last_receive_time = 0
